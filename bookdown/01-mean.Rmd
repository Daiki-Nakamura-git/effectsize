# 平均値と推測統計の基礎

本章では、多くの読者にとってなじみが深い指標であろう**平均値**（相加平均）が効果量として解釈可能であることを示した上で、正規母集団から得られた標本を用いて母平均$\mu$ の点推定・区間推定を行うことを通して、推測統計の基礎を確認する。また、ベイズ統計に基づくアプローチについても紹介する。

## 効果量としての平均値

ある研究においてn個の観測値 $x_1, x_2, ..., x_n$ が得られたとき、平均値は以下の式で計算できる。 $$
\bar{x}=\frac{1}{n}(x_1+x_2+...+x_n)=\frac{1}{n}\sum_{i=1}^{n}x_i
$$ 平均は全観測値の重心を示すものであり、分布が左右対称の場合は全観測値の中心を示す。 研究間で同一の測定が実現しているとき、各研究から得られた平均値を比較可能である。 特に、元の測定単位における比較に関心がある場合、平均値を比較することは有用かもしれない。

## 母平均の推定

母集団における平均（母平均$\mu$）を知りたい場合、理想的には全数調査を行い平均値を計算すればよいが、このような調査はコストがかかるため多くの場合、現実的ではない。そこで、母集団からの抽出された標本を用いて母平均$\mu$を推定することを考える。

標本調査によって、平均$\mu=5$、分散$\sigma^2=1$の正規分布に独立に従う100個の標本が得られたとする。$$
x_1, x_2, ..., x_{100} \sim \mathcal{N}(5, 1)
$$ 実際には、得られた標本がどのような母数の分布に従うかは多くの場合、未知である。 得られた標本から母平均を推定することを考えてみよう。

### 点推定

標本から母平均 $\mu$ を点推定する場合、推定量には標本平均 $\bar{x}$ を用いる。 これは、大数の法則より、標本平均 $\bar{x}$ はサンプルサイズ $n$ が大きくなると母平均 $\mu$ に近づくという**一致性**を持つからである（$\bar{x}\stackrel{p}{\longrightarrow}\mu$）。 また、標本平均 $\bar{x}$ の期待値 $E[\bar{x}]=\mu$ となることから、サンプルサイズ $n$ に関係なく標本平均 $\bar{x}$ の期待値は母平均に一致するという**不偏性**を持つ。 よって、標本平均 $\bar{x}$ は母平均 $\mu$ の一致推定量かつ不偏推定量である。

このことを確かめるために、Rを使用して以下のようなシミュレーションを行ってみよう。ここでは毎回同じ結果が再現されるよう乱数の種を固定したうえで、平均 $\mu=5$、分散 $\sigma^2=1$ の正規分布に独立に従う $n$個の乱数を発生させ、それらの標本平均を求めるシミュレーションを $k$回繰り返している。例えば、サンプルサイズ $n=100$ の標本平均を算出することを1000回繰り返すと、その平均は5.000977になることが分かる。

```{r }
m <- NULL # 結果の格納用
n = 100   # サンプルサイズ
k = 1000  # シミュレーション回数
set.seed(123) # 乱数の種の固定
for(i in 1:k){
  dat <- rnorm(n, 5, 1) # 正規分布N(5,1)からn個の乱数を発生
  m[i] <- mean(dat)     # 標本平均の格納
}
mean(m)   # k個の標本平均の平均
```

$n$ や $k$ の値を変えながら様々な条件で標本平均の計算を繰り返すと以下のような結果が得られる。

| k \\ n | 1        | 5       | 10       | 20       | 100      | 1000     | 10000    |
|:-------|:---------|:--------|:---------|:---------|:---------|:---------|:---------|
| 1      | 4.439524 | 5.19357 | 5.074626 | 5.141624 | 5.090406 | 5.016128 | 4.997628 |
| 100    | 5.090406 | 5.03459 | 5.016128 | 5.029297 | 4.997628 | 5.000977 | 4.999479 |
| 1000   | 5.016128 | 4.99943 | 4.997628 | 4.994261 | 5.000977 | 4.999479 | 5.000115 |
| 10000  | 4.997628 | 4.99826 | 5.000977 | 5.003096 | 4.999479 | 5.000115 | 5.000157 |
| 100000 | 5.000977 | 5.00006 | 4.999479 | 4.998962 | 5.000115 | 5.000157 | 5.000010 |

: 標本平均のシミュレーション

表より、シミュレーション回数 $k=1$ の行を横に見ると、サンプルサイズ $n$ が増加するにつれて、標本平均 $\bar{x}$ が母平均 $\mu=5$ に近づく一致性が確認できる。また、シミュレーション回数 $k=100000$ の行を横に見ると、サンプルサイズ $n$ に関係なく標本平均 $\bar{x}$ の期待値が $\bar{x}$ が母平均 $\mu=5$ に一致する不偏性が確認できる。

### 区間推定

点推定が母数を標本から得られる1つの値で推定したのに対して、区間推定では標本から得られる2つの値で母数が含まれる区間を推定する。

点推定の場合と同様、平均$\mu=5$、分散$\sigma^2=1$の正規分布に独立に従う100個の標本が得られているとする。ここで標本平均の標本分布が$\mathcal{N}(\mu, \sigma^2/n)$ に従うことを利用すれば、任意の確率で母平均を含む信頼区間（Confidence Interval）を構成することができる。

#### 母分散既知の場合

母分散が既知の場合、95%信頼区間は、以下の式で求められる。 $$
\bar{x}-1.96\frac{\sigma}{\sqrt{n}}\leq\mu\leq\bar{x}+1.96\frac{\sigma}{\sqrt{n}}
$$ 上式は母数を含んでいるため、標本から直接計算することはできない。 すでに先行研究などから母分散が分かっている場合、その値を代入して計算すればよい。

```{r 標本平均の信頼区間}
n <- 100 # サンプルサイズ
set.seed(123) # 乱数の種の固定
x <- rnorm(n, 5, 1) # 正規分布N(5,1)から100個の乱数を発生
m <- mean(x) # 標本平均
m - 1.96*1/sqrt(n) # 95%信頼区間の下限値
m + 1.96*1/sqrt(n) # 95%信頼区間の上限値
```

#### 母分散未知の場合

母分散が未知でもnが十分に大きい場合は、標本の標準偏差を$\sigma$に代入して計算してもよい（一致性があるため）。 母分散が未知でnが小さい場合、$\frac{\bar{x}-\mu}{\sigma/\sqrt{n}}$ が自由度 $n-1$ のｔ分布に従うことを利用して、95%信頼区間は以下の式で求められる。 ここで、$\hat{\sigma}$ は母標準偏差の推定値であり、標本の標準偏差を代入して計算する。$$
\bar{x}-t_{0.025}(n-1)\frac{\hat{\sigma}}{\sqrt{n}}\leq\mu\leq\bar{x}+t_{0.975}(n-1)\frac{\hat{\sigma}}{\sqrt{n}}
$$ Rでは、`qt()`を用いてｔ分布の任意の確率点を算出することができる。サンプルサイズを $n=20$ に変更して、95%信頼区間を求めてみよう。

```{r}
n <- 20             # サンプルサイズ
set.seed(123)       # 乱数の種の固定
x <- rnorm(n, 5, 1) # 正規分布N(5,1)からn個の乱数を発生
m <- mean(x)        # 標本平均
s <- sd(x)          # 標準偏差
m - qt(0.025, n-1, lower.tail = F)*s/sqrt(n) # 95%信頼区間の下限値
m + qt(0.975, n-1)*s/sqrt(n)                # 95%信頼区間の上限値
```

既存の関数を利用して95%信頼区間を求めても結果は一致する。

```{r}
t.test(x)$conf.int     # 既存の関数を利用した場合
```

95%信頼区間の意味するところは、標本調査を何回も繰り返してその度に95%信頼区間を構成した場合、95%の確率でそれらの区間内に母数が含まれている区間であるということである。 個々の信頼区間が母数を含むかどうかはTrue/Falseの2択であり、確率的な表現ができているわけではない。 実験を何回も繰り返すことのできる研究分野や様々な研究者によって類似の研究が繰り返される分野では、信頼区間の概念が想像しやすいだろう。 他方で、実験を繰り返すことが困難な分野では、1回の調査で得られたデータから任意の確率で母数を含む区間を構成したいと考えるかもしれない。 そこで、次の節ではベイズ統計の考え方を紹介し、ベイズ信用区間（Credible Interval）を構成する。

## ベイズ統計に基づくアプローチ

いま、正規母集団 $\mathcal{N}(\mu, \sigma^2)$ から大きさｎのデータを得たとする。この標本から母平均 $\mu$ を区間推定することを考える。ベイズ統計では、母数に関する事前の信念を確率モデルを用いて表現する（事前分布）。そして、ベイズの定理を用いて、事前分布と尤度から、データを得た後の事後分布を求める。

ここでは、母分散が既知であるのに対して、母平均 $\mu$ に関して少ない情報しか持っておらず、 $\mu$ の事前分布を一様分布と設定したとしよう。観測されたデータを用いて事前分布を更新すれば、事後分布は $\mathcal{N}(\bar{x}, \sigma/\sqrt{n})$ になる。この事後分布を利用して95%の確率で母平均 $\mu$ を含む区間を構成すれば、95%信用区間は以下の通りになる。

$$
\bar{x}-1.96\frac{\sigma}{\sqrt{n}}\leq\mu\leq\bar{x}+1.96\frac{\sigma}{\sqrt{n}}
$$

こうして構成した信用区間は、信頼区間とまったく異なる概念であることに注意が必要である。95%信用区間は、その区間内に95%の確率で母数が存在すると信用できる区間である。繰り返しの調査を前提とする必要はない。

## 結果の報告

非標準化効果量として平均値を報告する際には、以下の3点を報告すればよい。

1.  母平均の推定値（標本平均）

2.  推定値の不確かさ（95%信頼区間など）

3.  推定値の単位

例）今回得られた標本における長さの平均は5.14cm, 95% CI [4.69, 5.60] であった。
